{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "report.v1.json",
  "type": "object",
  "required": ["run_id", "mode", "created_at", "version", "summary"],
  "properties": {
    "run_id": {"type": "string"},
    "mode": {"type": "string", "enum": ["offline", "experiment", "ope", "interleaving", "aa-check"]},
    "created_at": {"type": "string", "format": "date-time"},
    "version": {"type": "string"},
    "binary_version": {"type": "string"},
    "git_commit": {"type": "string"},
    "effective_config": {"type": ["object", "array"]},
    "input_dataset_fingerprint": {"type": "string"},
    "summary": {
      "type": "object",
      "required": ["cases_evaluated"],
      "properties": {
        "cases_evaluated": {"type": "integer"},
        "executive": {
          "type": "object",
          "properties": {
            "decision": {"type": "string", "enum": ["pass", "fail", "not_configured"]},
            "gate_failures": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "metric": {"type": "string"},
                  "max_drop": {"type": "number"},
                  "delta": {"type": "number"},
                  "passed": {"type": "boolean"}
                }
              }
            },
            "highlights": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {"type": "string"},
                  "value": {"type": "number"}
                }
              }
            },
            "key_deltas": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {"type": "string"},
                  "delta": {"type": "number"},
                  "relative_delta": {"type": "number"},
                  "before": {"type": "number"},
                  "after": {"type": "number"}
                }
              }
            },
            "next_steps": {
              "type": "array",
              "items": {"type": "string"}
            }
          }
        }
      },
      "additionalProperties": true
    },
    "offline": {"type": "object"},
    "experiment": {"type": "object"},
    "ope": {"type": "object"},
    "interleaving": {"type": "object"},
    "aa_check": {"type": "object"},
    "data_quality": {"type": "object"},
    "gates": {"type": "array"},
    "warnings": {"type": "array"}
  },
  "additionalProperties": true
}
