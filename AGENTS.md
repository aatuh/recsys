# Repository Guidelines

## Project Structure & Module Organization
Core services run through `docker-compose.yml` and the root `Makefile`. `api/` contains the Go REST API (handlers under `api/`, business logic in `internal/`, migrations in `migrations/`, integration fixtures in `test/`). `web/` hosts the Vite + React TypeScript web UI, with generated clients in `src/lib/api-client`. `db/` seeds Postgres via `initdb/`, and `proxy/` supplies the edge proxy Dockerfile.

## Build, Test, and Development Commands
- `make dev` launches API, Postgres, proxy, and web UI; run `make down` to stop and reset volumes.
- `make build` rebuilds every service image after Dockerfile or dependency updates.
- `make codegen` refreshes Swagger plus the UI API client (Docker and `pnpm` required). Always run it before doing changes to Web UI after changing API code.
- `make test` runs the Go suite in containers; scope with `PKG=./internal/...` or `TEST_PATTERN=Recommend`.
- In `web/`, use `pnpm dev` for local preview, `pnpm build` for bundles, and `pnpm lint` / `pnpm typecheck` before committing.
- Inspect the output of plain `make` command to see available commands and more details.

## Coding Style & Naming Conventions
- Keep Go code `gofmt`-clean with lower_snake_case packages and PascalCase exports; colocate new handlers with their routes and prefer structured `zap` logging.
- Name Go tests `*_test.go`, mirror the package under test, and keep fixtures in `api/test`.
- TypeScript follows `web/eslint.config.js`; use PascalCase for components, camelCase for hooks/utilities, and avoid editing generated files in `src/lib/api-client`.
- Do not change autogenerated code manually. Always use `make codegen` to create autogenerated code.

## Testing Guidelines
- Run `make test` ahead of every PR; the target spins up the disposable `test` service and executes `go test ./...`.
- Narrow investigations with `make test TEST_PATTERN=Blend` or `PKG=./internal/recommendation` as needed.
- UI work must pass `pnpm lint` and `pnpm typecheck`; when adding tests, place `.test.tsx` files beside the component they cover.
- Exercise new migrations with `make migrate-up` and `make migrate-down` from `api/` to confirm forward and backward compatibility.

## Commit & Pull Request Guidelines
- Follow local history: concise, imperative subjects in sentence case ending with a period (e.g., `Refine bandit defaults.`) plus optional detail in the body.
- Group related code, schema, and regenerated artifacts to keep reviews focused.
- PRs should include intent, validation evidence, and linked issues; attach before/after screenshots when UI output changes.
- Request reviewers for the affected surface (`api`, `web`, or infra) and call out breaking migrations or config updates explicitly.

## Environment & Configuration Tips
- There is an `.env` file in API and web UI directories created from corresponding `.env.example` files for local development. docker-compose loads it automatically.
- Use Swagger JSON from `http://localhost:8081/swagger.json` while developing to verify contract changes against the generated client.

## Documentation
- New or changed features should be documented into the root level README. Plain and clear English languge must be used to explain features to maximize clarity and usability of the document.
