# Dev image with hot reload + tools
FROM golang:1.24-alpine AS dev
WORKDIR /app

# System deps for builds and psql client
RUN apk add --no-cache bash curl git ca-certificates tzdata build-base postgresql-client

# Go env
ENV CGO_ENABLED=1 \
    GO111MODULE=on \
    GOPROXY=https://proxy.golang.org,direct \
    GOSUMDB=sum.golang.org

# Install tools
RUN go install github.com/cespare/reflex@latest && \
    go install github.com/swaggo/swag/cmd/swag@latest && \
    go install entgo.io/ent/cmd/ent@latest && \
    go install gotest.tools/gotestsum@latest

# Atlas (migrations)
RUN curl -sSf https://atlasgo.sh | sh
ENV PATH="/root/bin:/go/bin:${PATH}"

# Warm module cache for faster iterative builds; source code is mounted at runtime
COPY go.mod go.sum* ./
RUN go mod download || true
