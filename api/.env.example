API_ADDR=:8000
DATABASE_URL=postgres://recsys-db:recsys@db:5432/recsys-db
# DATABASE_URL_FILE=/run/secrets/database_url
LOG_LEVEL=debug
MIGRATE_ON_START=true
MIGRATIONS_DIR=-

# Auth (local dev)
AUTH_REQUIRED=true
AUTH_REQUIRE_TENANT_CLAIM=false
TENANT_HEADER_NAME=X-Org-Id
AUTH_TENANT_CLAIMS=tenant_id,org_id,orgId,organization_id
AUTH_ROLE_CLAIMS=roles,role,scope,scopes
AUTH_VIEWER_ROLE=viewer
AUTH_OPERATOR_ROLE=operator
AUTH_ADMIN_ROLE=admin # empty if disable admin role

# JWT (production)
JWT_AUTH_ENABLED=false
JWT_JWKS_URL=
JWT_ISSUER=
JWT_AUDIENCE=
JWT_ALLOWED_ALGORITHMS=
JWT_JWKS_REFRESH_INTERVAL=10m
JWT_JWKS_REFRESH_TIMEOUT=5s
JWT_ALLOWED_CLOCK_SKEW=30s
JWT_ALLOW_DANGEROUS_DEV_BYPASSES=false
JWT_SKIP_HEADER_ENABLED=false
JWT_SKIP_HEADER_NAME=
JWT_SKIP_TRUSTED_PROXIES=
AUTH_ALLOW_INSECURE_JWKS=false
AUTH_JWKS_ALLOWED_HOSTS=

# API keys
API_KEY_ENABLED=false
API_KEY_HEADER=X-API-Key
API_KEY_HASH_SECRET=

# License status (optional)
RECSYS_LICENSE_FILE=
RECSYS_LICENSE_PUBLIC_KEY=
RECSYS_LICENSE_PUBLIC_KEY_FILE=
RECSYS_LICENSE_CACHE_TTL=1m

# Dev header auth (for local/test)
DEV_AUTH_ENABLED=true
DEV_AUTH_USER_ID_HEADER=X-Dev-User-Id
DEV_AUTH_EMAIL_HEADER=X-Dev-User-Email
DEV_AUTH_FIRST_NAME_HEADER=X-Dev-User-First
DEV_AUTH_LAST_NAME_HEADER=X-Dev-User-Last
DEV_AUTH_DEFAULT_LANGUAGE=
DEV_AUTH_TENANT_HEADER=X-Dev-Org-Id

# CORS (browser clients like Swagger UI)
CORS_ALLOWED_ORIGINS=http://localhost:8001,http://127.0.0.1:8001
CORS_ALLOWED_METHODS=GET,POST,PUT,DELETE,OPTIONS
CORS_ALLOWED_HEADERS=Accept,Authorization,Content-Type,X-Org-Id,X-Dev-Org-Id,X-Dev-User-Id,X-Dev-User-Email,X-API-Key,X-Request-Id
CORS_ALLOW_CREDENTIALS=false
CORS_MAX_AGE=300

# Per-tenant rate limiting
TENANT_RATE_LIMIT_ENABLED=true
TENANT_RATE_LIMIT_CAPACITY=60
TENANT_RATE_LIMIT_REFILL_RATE=30
TENANT_RATE_LIMIT_RETRY_AFTER=1s
TENANT_RATE_LIMIT_FAIL_OPEN=false

# Audit logging (admin actions)
AUDIT_LOG_ENABLED=false
AUDIT_LOG_PATH=
AUDIT_LOG_FSYNC=false

# Exposure logging
EXPOSURE_LOG_ENABLED=false
EXPOSURE_LOG_PATH=
EXPOSURE_LOG_FORMAT=service_v1
EXPOSURE_LOG_FSYNC=false
EXPOSURE_LOG_RETENTION_DAYS=30
EXPOSURE_HASH_SALT=

# Artifact/manifest mode
# When enabled, the service reads popularity/co-vis artifacts via the manifest.
# Artifacts are not built automatically; pipelines must publish the manifest and blobs.
RECSYS_ARTIFACT_MODE_ENABLED=false
RECSYS_ARTIFACT_MANIFEST_TEMPLATE=s3://recsys-artifacts/registry/current/{tenant}/{surface}/manifest.json
RECSYS_ARTIFACT_MANIFEST_TTL=1m
RECSYS_ARTIFACT_CACHE_TTL=1m
RECSYS_ARTIFACT_MAX_BYTES=10000000
RECSYS_ARTIFACT_S3_ENDPOINT=minio:9000
RECSYS_ARTIFACT_S3_ACCESS_KEY=minioadmin
RECSYS_ARTIFACT_S3_SECRET_KEY=minioadmin
RECSYS_ARTIFACT_S3_REGION=us-east-1
RECSYS_ARTIFACT_S3_USE_SSL=false

# Experiment assignment
EXPERIMENT_ASSIGNMENT_ENABLED=true
EXPERIMENT_DEFAULT_VARIANTS=A,B
EXPERIMENT_ASSIGNMENT_SALT=

# Explain/trace safeguards
RECSYS_EXPLAIN_MAX_ITEMS=50
RECSYS_EXPLAIN_REQUIRE_ADMIN=true

# recsys-algo defaults
RECSYS_ALGO_VERSION=recsys-algo@local
RECSYS_ALGO_DEFAULT_NAMESPACE=default
RECSYS_ALGO_MODE=blend
RECSYS_ALGO_PLUGIN_ENABLED=false
RECSYS_ALGO_PLUGIN_PATH= # overrides algo module with a custom Go plugin (.so)
RECSYS_ALGO_BLEND_ALPHA=1
RECSYS_ALGO_BLEND_BETA=0
RECSYS_ALGO_BLEND_GAMMA=0
RECSYS_ALGO_PROFILE_BOOST=0.6
RECSYS_ALGO_PROFILE_WINDOW_DAYS=30
RECSYS_ALGO_PROFILE_TOP_N=5
RECSYS_ALGO_PROFILE_MIN_EVENTS=10
RECSYS_ALGO_PROFILE_COLD_START_MULT=0.5
RECSYS_ALGO_PROFILE_STARTER_BLEND_WEIGHT=0.5
RECSYS_ALGO_MMR_LAMBDA=0
RECSYS_ALGO_BRAND_CAP=0
RECSYS_ALGO_CATEGORY_CAP=0
RECSYS_ALGO_HALF_LIFE_DAYS=30
RECSYS_ALGO_COVIS_WINDOW_DAYS=30
RECSYS_ALGO_PURCHASED_WINDOW_DAYS=30
RECSYS_ALGO_RULE_EXCLUDE_EVENTS=false
RECSYS_ALGO_EXCLUDE_EVENT_TYPES=
RECSYS_ALGO_BRAND_TAG_PREFIXES=brand:
RECSYS_ALGO_CATEGORY_TAG_PREFIXES=category:
RECSYS_ALGO_RULES_ENABLED=false
RECSYS_ALGO_RULES_REFRESH_INTERVAL=2s
RECSYS_ALGO_RULES_MAX_PINS=3
RECSYS_ALGO_POPULARITY_FANOUT=0
RECSYS_ALGO_MAX_K=200
RECSYS_ALGO_MAX_FANOUT=0
RECSYS_ALGO_MAX_EXCLUDE_IDS=200
RECSYS_ALGO_MAX_ANCHORS_INJECTED=50
RECSYS_ALGO_SESSION_LOOKBACK_EVENTS=50
RECSYS_ALGO_SESSION_LOOKAHEAD_MINUTES=120

# Observability (OpenTelemetry)
OTEL_TRACING_ENABLED=false
OTEL_SERVICE_NAME=recsys-service
OTEL_EXPORTER_OTLP_ENDPOINT=
OTEL_EXPORTER_OTLP_PROTOCOL=grpc
OTEL_TRACES_SAMPLER=
OTEL_TRACES_SAMPLER_ARG=
OTEL_SAMPLE_RATIO=

# Performance & scaling
RECSYS_BACKPRESSURE_MAX_INFLIGHT=0
RECSYS_BACKPRESSURE_MAX_QUEUE=0
RECSYS_BACKPRESSURE_WAIT_TIMEOUT=200ms
RECSYS_BACKPRESSURE_RETRY_AFTER=1s
RECSYS_CONFIG_CACHE_TTL=5m
RECSYS_RULES_CACHE_TTL=5m
PPROF_ENABLED=false
